(function(){function s(g,e,n){function t(o,i){if(!e[o]){if(!g[o]){var d="function"==typeof require&&require;if(!i&&d)return d(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var a=e[o]={exports:{}};g[o][0].call(a.exports,function(e){var i=g[o][1][e];return t(i||e)},a,a.exports,s,g,e,n)}return e[o].exports}for(var r="function"==typeof require&&require,o=0;o<n.length;o++)t(n[o]);return t}return s})()({1:[function(e,t){"use strict";var n=Math.min,i=Math.max;const r=e("./src/Drawer"),o=e("./src/Parser");var a=!!("undefined"!=typeof window&&window.document&&window.document.createElement),s={Version:"1.0.0"};s.Drawer=r,s.Parser=o,s.clean=function(e){return e.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")},s.apply=function(e,t="canvas[data-smiles]",n="light",o=null){let a=new r(e),g=document.querySelectorAll(t);for(var d=0;d<g.length;d++){let e=g[d];s.parse(e.getAttribute("data-smiles"),function(t){a.draw(t,e,n,!1)},function(e){o&&o(e)})}},s.parse=function(e,t,n){try{t&&t(o.parse(e))}catch(e){n&&n(e)}},a&&(window.SmilesDrawer=s),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null==this)throw new TypeError("this is null or not defined");for(var t=Object(this),r=t.length>>>0,o=arguments[1],a=o>>0,s=0>a?i(r+a,0):n(a,r),g=arguments[2],d=void 0===g?r:g>>0,l=0>d?i(r+d,0):n(d,r);s<l;)t[s]=e,s++;return t}}),t.exports=s},{"./src/Drawer":5,"./src/Parser":10}],2:[function(e,t){"use strict";var n=Math.min;class r{static clone(e){let t=Array.isArray(e)?[]:{};for(let n in e){let i=e[n];t[n]="function"==typeof i.clone?i.clone():"object"==typeof i?r.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let n=e.slice().sort(),r=t.slice().sort();for(var o=0;o<n.length;o++)if(n[o]!==r[o])return!1;return!0}static print(e){if(0==e.length)return"";let t="(";for(let n=0;n<e.length;n++)t+=e[n].id?e[n].id+", ":e[n]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let n=0;n<e.length;n++)t(e[n])}static get(e,t,n){for(let r=0;r<e.length;r++)if(e[r][t]==n)return e[r]}static contains(e,t){if(!t.property&&!t.func){for(let n=0;n<e.length;n++)if(e[n]==t.value)return!0;}else if(t.func){for(let n=0;n<e.length;n++)if(t.func(e[n]))return!0;}else for(let n=0;n<e.length;n++)if(e[n][t.property]==t.value)return!0;return!1}static intersection(e,t){let n=[];for(let r=0;r<e.length;r++)for(let i=0;i<t.length;i++)e[r]===t[i]&&n.push(e[r]);return n}static unique(e){let t={};return e.filter(function(e){return!(t[e]!==void 0)&&(t[e]=!0)})}static count(e,t){let n=0;for(let r=0;r<e.length;r++)e[r]===t&&n++;return n}static toggle(e,t){let n=[],r=!1;for(let o=0;o<e.length;o++)e[o]===t?r=!0:n.push(e[o]);return r||n.push(t),n}static remove(e,t){let n=[];for(let r=0;r<e.length;r++)e[r]!==t&&n.push(e[r]);return n}static removeUnique(e,t){let n=e.indexOf(t);return-1<n&&e.splice(n,1),e}static removeAll(e,t){return e.filter(function(e){return-1===t.indexOf(e)})}static merge(e,t){let n=Array(e.length+t.length);for(let r=0;r<e.length;r++)n[r]=e[r];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n}static containsAll(e,t){let n=0;for(let r=0;r<e.length;r++)for(let i=0;i<t.length;i++)e[r]===t[i]&&n++;return n===t.length}static sortByAtomicNumberDesc(t){let i=t.map(function(t,e){return{index:e,value:t.atomicNumber.split(".").map(Number)}});return i.sort(function(e,t){let r=n(t.value.length,e.value.length),o=0;for(;o<r&&t.value[o]===e.value[o];)o++;return o===r?t.value.length-e.value.length:t.value[o]-e.value[o]}),i.map(function(n){return t[n.index]})}static deepCopy(e){let t=[];for(let n,o=0;o<e.length;o++)n=e[o],t[o]=n instanceof Array?r.deepCopy(n):n;return t}}t.exports=r},{}],3:[function(e,t){"use strict";const n=e("./ArrayHelper"),i=e("./Vertex"),r=e("./Ring");class o{constructor(e,t="-"){this.element=1===e.length?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=[],this.rings=[],this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=[],this.bridgedRing=null,this.anchoredRings=[],this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=[],this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,n=0,i=0){null===n&&(n=0),null===i&&(i=0);let r=n+e+i;this.attachedPseudoElements[r]?this.attachedPseudoElements[r].count+=1:this.attachedPseudoElements[r]={element:e,count:1,hydrogenCount:n,previousElement:t,charge:i},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(n){e[n]=t.attachedPseudoElements[n]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return"C"!==this.element&&"H"!==this.element}addAnchoredRing(e){n.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let n=0;n<e.ringbonds.length;n++)for(let i=0;i<t.ringbonds.length;i++)if(e.ringbonds[n].id==t.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return o.atomicNumbers[this.element]}getMaxBonds(){return o.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}}t.exports=o},{"./ArrayHelper":2,"./Ring":11,"./Vertex":15}],4:[function(e,t){"use strict";var n=Number.MAX_VALUE;const i=e("./MathHelper"),o=e("./Vector2"),a=e("./Line"),s=e("./Vertex"),g=e("./Ring");t.exports=class{constructor(e,t,n){this.canvas="string"==typeof e||e instanceof String?document.getElementById(e):e,this.ctx=this.canvas.getContext("2d"),this.colors=t,this.opts=n,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,1===this.ratio?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0))}setTheme(e){this.colors=e}scale(e){let t=-n,r=-n,o=n,a=n;for(var s=0;s<e.length;s++){if(!e[s].value.isDrawn)continue;let n=e[s].position;t<n.x&&(t=n.x),r<n.y&&(r=n.y),o>n.x&&(o=n.x),a>n.y&&(a=n.y)}var g=this.opts.padding;t+=g,r+=g,o-=g,a-=g,this.drawingWidth=t-o,this.drawingHeight=r-a;var d=this.canvas.offsetWidth/this.drawingWidth,l=this.canvas.offsetHeight/this.drawingHeight,h=d<l?d:l;this.ctx.scale(h,h),this.offsetX=-o,this.offsetY=-a,d<l?this.offsetY+=this.canvas.offsetHeight/(2*h)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*h)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,n,r,o=!0,a=!1,s=""){let g=this.ctx,d=this.offsetX,l=this.offsetY;g.save(),g.lineWidth=1.5,g.beginPath(),g.arc(e+d,t+l,n,0,i.twoPI,!0),g.closePath(),a?(o?(g.fillStyle="#f00",g.fill()):(g.strokeStyle="#f00",g.stroke()),this.drawDebugText(e,t,s)):o?(g.fillStyle=r,g.fill()):(g.strokeStyle=r,g.stroke()),g.restore()}drawLine(e,t=!1,n=1){let i=this.ctx,o=this.offsetX,a=this.offsetY,s=e.clone().shorten(4),g=s.getLeftVector().clone(),d=s.getRightVector().clone();g.x+=o,g.y+=a,d.x+=o,d.y+=a,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(g.x,g.y),i.lineTo(d.x,d.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),g=e.getLeftVector().clone(),d=e.getRightVector().clone(),g.x+=o,g.y+=a,d.x+=o,d.y+=a,i.save(),i.beginPath(),i.moveTo(g.x,g.y),i.lineTo(d.x,d.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let h=this.ctx.createLinearGradient(g.x,g.y,d.x,d.y);h.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),h.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),1>n&&(i.globalAlpha=n),i.strokeStyle=h,i.stroke(),i.restore()}drawWedge(e,n=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let i=this.ctx,a=this.offsetX,s=this.offsetY,g=e.clone().shorten(5),d=g.getLeftVector().clone(),h=g.getRightVector().clone();d.x+=a,d.y+=s,h.x+=a,h.y+=s,d=e.getLeftVector().clone(),h=e.getRightVector().clone(),d.x+=a,d.y+=s,h.x+=a,h.y+=s,i.save();let c=o.normals(d,h);c[0].normalize(),c[1].normalize();let p=e.getRightChiral(),f=d,m=h;p&&(f=h,m=d);let b=o.add(f,o.multiplyScalar(c[0],this.halfBondThickness)),t=o.add(m,o.multiplyScalar(c[0],1.5+this.halfBondThickness)),u=o.add(m,o.multiplyScalar(c[1],1.5+this.halfBondThickness)),v=o.add(f,o.multiplyScalar(c[1],this.halfBondThickness));i.beginPath(),i.moveTo(b.x,b.y),i.lineTo(t.x,t.y),i.lineTo(u.x,u.y),i.lineTo(v.x,v.y);let x=this.ctx.createRadialGradient(h.x,h.y,this.opts.bondLength,h.x,h.y,0);x.addColorStop(.4,this.getColor(e.getLeftElement())||this.getColor("C")),x.addColorStop(.6,this.getColor(e.getRightElement())||this.getColor("C")),i.fillStyle=x,i.fill(),i.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let n=this.ctx,i=this.offsetX,a=this.offsetY,s=e.getLeftVector().clone(),g=e.getRightVector().clone();s.x+=i,s.y+=a,g.x+=i,g.y+=a,n.save();let r=o.normals(s,g);r[0].normalize(),r[1].normalize();let d,l,h,c,p=e.getRightChiral(),u=e.clone();p?(d=g,l=s,u.shortenRight(1),h=u.getRightVector().clone(),c=u.getLeftVector().clone()):(d=s,l=g,u.shortenLeft(1),h=u.getLeftVector().clone(),c=u.getRightVector().clone()),h.x+=i,h.y+=a,c.x+=i,c.y+=a;let v=o.subtract(l,d).normalize();n.strokeStyle=this.getColor("C"),n.lineCap="round",n.lineWidth=this.opts.bondThickness,n.beginPath();let f=e.getLength(),m=1.25/(f/(3*this.opts.bondThickness)),b=!1;for(var x=0;1>x;x+=m){let t=o.multiplyScalar(v,x*f),i=o.add(d,t),a=1.5*x,s=o.multiplyScalar(r[0],a);!b&&.5<x&&(n.stroke(),n.beginPath(),n.strokeStyle=this.getColor(e.getRightElement())||this.getColor("C"),b=!0),i.subtract(s),n.moveTo(i.x,i.y),i.add(o.multiplyScalar(s,2)),n.lineTo(i.x,i.y)}n.stroke(),n.restore()}drawDebugText(e,t,n){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(n,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,n){let r=this.ctx;r.save(),r.beginPath(),r.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,i.twoPI,!1),r.fillStyle=this.getColor(n),r.fill(),r.restore()}drawPoint(e,t,n){let r=this.ctx,o=this.offsetX,a=this.offsetY;r.save(),r.globalCompositeOperation="destination-out",r.beginPath(),r.arc(e+o,t+a,1.5,0,i.twoPI,!0),r.closePath(),r.fill(),r.globalCompositeOperation="source-over",r.beginPath(),r.arc(e+this.offsetX,t+this.offsetY,.75,0,i.twoPI,!1),r.fillStyle=this.getColor(n),r.fill(),r.restore()}drawText(e,t,n,o,a,s,g,d,l={}){let h=this.ctx,c=this.offsetX,p=this.offsetY;h.save(),h.textAlign="start",h.textBaseline="alphabetic";let u="",v=0;g&&(u=this.getChargeText(g),h.font=this.fontSmall,v=h.measureText(u).width);let f="0",m=0;0<d&&(f=d.toString(),h.font=this.fontSmall,m=h.measureText(f).width),1===g&&"N"===n&&l.hasOwnProperty("0O")&&l.hasOwnProperty("0O-1")&&(l={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},g=0),h.font=this.fontLarge,h.fillStyle=this.getColor("BACKGROUND");let b=h.measureText(n);b.totalWidth=b.width+v,b.height=parseInt(this.fontLarge,10);let x=b.width>this.opts.fontSizeLarge?b.width:this.opts.fontSizeLarge;x/=1.5,h.globalCompositeOperation="destination-out",h.beginPath(),h.arc(e+c,t+p,x,0,i.twoPI,!0),h.closePath(),h.fill(),h.globalCompositeOperation="source-over";let y=-b.width/2,S=-b.width/2;h.fillStyle=this.getColor(n),h.fillText(n,e+c+y,t+this.opts.halfFontSizeLarge+p),y+=b.width,g&&(h.font=this.fontSmall,h.fillText(u,e+c+y,t-this.opts.fifthFontSizeSmall+p),y+=v),0<d&&(h.font=this.fontSmall,h.fillText(f,e+c+S-m,t-this.opts.fifthFontSizeSmall+p),S-=m),h.font=this.fontLarge;let C=0,R=0;if(1===o){let n=e+c,i=t+p+this.opts.halfFontSizeLarge;C=this.hydrogenWidth,S-=C,"left"===a?n+=S:"right"===a?n+=y:"up"===a&&s?n+=y:"down"===a&&s?n+=y:"up"!==a||s?"down"===a&&!s&&(i+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,n-=this.halfHydrogenWidth):(i-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,n-=this.halfHydrogenWidth),h.fillText("H",n,i),y+=C}else if(1<o){let n=e+c,i=t+p+this.opts.halfFontSizeLarge;C=this.hydrogenWidth,h.font=this.fontSmall,R=h.measureText(o).width,S-=C+R,"left"===a?n+=S:"right"===a?n+=y:"up"===a&&s?n+=y:"down"===a&&s?n+=y:"up"!==a||s?"down"===a&&!s&&(i+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,n-=this.halfHydrogenWidth):(i-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,n-=this.halfHydrogenWidth),h.font=this.fontLarge,h.fillText("H",n,i),h.font=this.fontSmall,h.fillText(o,n+this.halfHydrogenWidth+R,i+this.opts.fifthFontSizeSmall),y+=C+this.halfHydrogenWidth+R}for(let i in l){if(!l.hasOwnProperty(i))continue;let n=0,r=0,o=l[i].element,s=l[i].count,g=l[i].hydrogenCount,d=l[i].charge;h.font=this.fontLarge,1<s&&0<g&&(n=h.measureText("(").width,r=h.measureText(")").width);let u=h.measureText(o).width,v=0,f="",m=0;C=0,0<g&&(C=this.hydrogenWidth),h.font=this.fontSmall,1<s&&(v=h.measureText(s).width),0!==d&&(f=this.getChargeText(d),m=h.measureText(f).width),R=0,1<g&&(R=h.measureText(g).width),h.font=this.fontLarge;let b=e+c,x=t+p+this.opts.halfFontSizeLarge;h.fillStyle=this.getColor(o),0<s&&(S-=v),1<s&&0<g&&("left"===a?(S-=r,h.fillText(")",b+S,x)):(h.fillText("(",b+y,x),y+=n)),"left"===a?(S-=u,h.fillText(o,b+S,x)):(h.fillText(o,b+y,x),y+=u),0<g&&("left"===a?(S-=C+R,h.fillText("H",b+S,x),1<g&&(h.font=this.fontSmall,h.fillText(g,b+S+C,x+this.opts.fifthFontSizeSmall))):(h.fillText("H",b+y,x),y+=C,1<g&&(h.font=this.fontSmall,h.fillText(g,b+y,x+this.opts.fifthFontSizeSmall),y+=R))),h.font=this.fontLarge,1<s&&0<g&&("left"===a?(S-=n,h.fillText("(",b+S,x)):(h.fillText(")",b+y,x),y+=r)),h.font=this.fontSmall,1<s&&("left"===a?h.fillText(s,b+S+n+r+C+R+u,x+this.opts.fifthFontSizeSmall):(h.fillText(s,b+y,x+this.opts.fifthFontSizeSmall),y+=v)),0!==d&&("left"===a?h.fillText(f,b+S+n+r+C+R+u,t-this.opts.fifthFontSizeSmall+p):(h.fillText(f,b+y,t-this.opts.fifthFontSizeSmall+p),y+=m))}h.restore()}getChargeText(e){return 1===e?"+":2===e?"2+":-1===e?"-":-2===e?"2-":""}drawDebugPoint(e,t,n="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,n)}drawAromaticityRing(e){let t=this.ctx,n=i.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,n-this.opts.bondSpacing,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}}},{"./Line":8,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],5:[function(e,t){"use strict";var n=Math.sin,i=Math.cos,r=Math.sqrt,o=Math.PI,s=Math.min,g=Math.max;const d=e("./MathHelper"),l=e("./ArrayHelper"),h=e("./Vector2"),c=e("./Line"),p=e("./Vertex"),u=e("./Edge"),v=e("./Atom"),f=e("./Ring"),m=e("./RingConnection"),b=e("./CanvasWrapper"),x=e("./Graph"),y=e("./SSSR");t.exports=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,bondThickness:.6,bondLength:15,shortBondLength:.85,bondSpacing:15*.18,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!1,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontSizeLarge:5,fontSizeSmall:3,padding:20,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#fff",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#222",BACKGROUND:"#fff"}}},this.opts=this.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}extend(){let e=this,t={},n=!1,r=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],r++);for(let i=function(i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=n&&"[object Object]"===Object.prototype.toString.call(i[r])?e.extend(!0,t[r],i[r]):i[r])};r<o;r++){let e=arguments[r];i(e)}return t}draw(e,t,n="light",r=!1){if(this.data=e,this.infoOnly=r,this.infoOnly||(this.canvasWrapper=new b(t,this.opts.themes[n],this.opts)),this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new x(e,this.opts.isomeric),this.rings=[],this.ringConnections=[],this.originalRings=[],this.originalRingConnections=[],this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.initRings(),this.initHydrogens(),!this.infoOnly){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var a=0;a<this.opts.overlapResolutionIterations;a++)for(var s=0;s<this.graph.edges.length;s++){let t=this.graph.edges[s];if(this.isEdgeRotatable(t)){let n=this.graph.getTreeDepth(t.sourceId,t.targetId),i=this.graph.getTreeDepth(t.targetId,t.sourceId),r=t.targetId,o=t.sourceId;n>i&&(r=t.sourceId,o=t.targetId);let a=this.getSubtreeOverlapScore(o,r,e.vertexScores);if(a.value>this.opts.overlapSensitivity){let t=this.graph.vertices[r],n=this.graph.vertices[o],i=n.getNeighbours(r);if(1===i.length){let e=this.graph.vertices[i[0]],r=e.position.getRotateAwayFromAngle(t.position,n.position,d.toRad(120));this.rotateSubtree(e.id,n.id,r,n.position);let o=this.getOverlapScore().total;o>this.totalOverlapScore?this.rotateSubtree(e.id,n.id,-r,n.position):this.totalOverlapScore=o}else if(2===i.length){if(0!==n.value.rings.length&&0!==t.value.rings.length)continue;let e=this.graph.vertices[i[0]],r=this.graph.vertices[i[1]];if(1===e.value.rings.length&&1===r.value.rings.length){if(e.value.rings[0]!==r.value.rings[0])continue;}else if(0!==e.value.rings.length||0!==r.value.rings.length)continue;else{let i=e.position.getRotateAwayFromAngle(t.position,n.position,d.toRad(120)),o=r.position.getRotateAwayFromAngle(t.position,n.position,d.toRad(120));this.rotateSubtree(e.id,n.id,i,n.position),this.rotateSubtree(r.id,n.id,o,n.position);let a=this.getOverlapScore().total;a>this.totalOverlapScore?(this.rotateSubtree(e.id,n.id,-i,n.position),this.rotateSubtree(r.id,n.id,-o,n.position)):this.totalOverlapScore=a}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&"default"===this.opts.atomVisualization&&this.initPseudoElements(),this.rotateDrawing(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections))}}edgeRingCount(e){let t=this.graph.edges[e],n=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return s(n.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=[];for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){const n=this.rings[t];e+=n.id+";",e+=n.members.length+";",e+=n.neighbours.length+";",e+=n.isSpiro?"true;":"false;",e+=n.isFused?"true;":"false;",e+=n.isBridged?"true;":"false;",e+=n.rings.length+";",e+="\n"}return e}rotateDrawing(){let e=0,t=0,n=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];if(i.value.isDrawn)for(var o=r+1;o<this.graph.vertices.length;o++){let a=this.graph.vertices[o];if(!a.value.isDrawn)continue;let s=i.position.distanceSq(a.position);s>n&&(n=s,e=r,t=o)}}let s=-h.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(s)){let e=s%.523599;.2617995>e?s-=e:s+=.523599-e;for(var r=0;r<this.graph.vertices.length;r++)r!==t&&this.graph.vertices[r].position.rotateAround(s,this.graph.vertices[t].position);for(var r=0;r<this.rings.length;r++)this.rings[r].center.rotateAround(s,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)"H"!==this.graph.vertices[t].value.element&&e++;return e}getMolecularFormula(){let t="",n=new Map;for(var r=0;r<this.graph.vertices.length;r++){let e=this.graph.vertices[r].value;if(n.has(e.element)?n.set(e.element,n.get(e.element)+1):n.set(e.element,1),e.bracket&&!e.bracket.chirality&&(n.has("H")?n.set("H",n.get("H")+e.bracket.hcount):n.set("H",e.bracket.hcount)),!e.bracket){let t=v.maxBonds[e.element]-e.bondCount;e.isPartOfAromaticRing&&t--,n.has("H")?n.set("H",n.get("H")+t):n.set("H",t)}}if(n.has("C")){let e=n.get("C");t+="C"+(1<e?e:""),n.delete("C")}if(n.has("H")){let e=n.get("H");t+="H"+(1<e?e:""),n.delete("H")}let e=Object.keys(v.atomicNumbers).sort();return e.map(i=>{if(n.has(i)){let e=n.get(i);t+=i+(1<e?e:"")}}),t}getRingbondType(e,t){if(1>e.value.getRingbondCount()||1>t.value.getRingbondCount())return null;for(var n=0;n<e.value.ringbonds.length;n++)for(var r=0;r<t.value.ringbonds.length;r++)if(e.value.ringbonds[n].id===t.value.ringbonds[r].id)return"-"===e.value.ringbonds[n].bondType?t.value.ringbonds[r].bond:e.value.ringbonds[n].bond;return null}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;0<=t;t--){let i=this.graph.vertices[t];if(0!==i.value.ringbonds.length)for(var n=0;n<i.value.ringbonds.length;n++){let t=i.value.ringbonds[n].id,r=i.value.ringbonds[n].bond;if(!e.has(t))e.set(t,[i.id,r]);else{let o=i.id,a=e.get(t)[0],s=e.get(t)[1],g=new u(o,a,1);g.setBondType(s||r||"-");let d=this.graph.addEdge(g),l=this.graph.vertices[a];i.addRingbondChild(a,n),i.value.addNeighbouringElement(l.value.element),l.addRingbondChild(o,n),l.value.addNeighbouringElement(i.value.element),i.edges.push(d),l.edges.push(d),e.delete(t)}}}let r=y.getRings(this.graph,this.opts.experimentalSSSR);if(null!==r){for(var t=0;t<r.length;t++){let e=[...r[t]],i=this.addRing(new f(e));for(var n=0;n<e.length;n++)this.graph.vertices[e[n]].value.rings.push(i)}for(var t=0;t<this.rings.length-1;t++)for(var n=t+1;n<this.rings.length;n++){let e=this.rings[t],i=this.rings[n],r=new m(e,i);0<r.vertices.size&&this.addRingConnection(r)}for(var t=0;t<this.rings.length;t++){let e=this.rings[t];e.neighbours=m.getNeighbours(this.ringConnections,e.id)}for(var t=0;t<this.rings.length;t++){let e=this.rings[t];this.graph.vertices[e.members[0]].value.addAnchoredRing(e.id)}for(this.backupRingInformation();0<this.rings.length;){let e=-1;for(var t=0;t<this.rings.length;t++){let n=this.rings[t];this.isPartOfBridgedRing(n.id)&&!n.isBridged&&(e=n.id)}if(-1===e)break;let n=this.getRing(e),i=this.getBridgedRingRings(n.id);this.bridgedRing=!0,this.createBridgedRing(i,n.members[0]);for(var t=0;t<i.length;t++)this.removeRing(i[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if("H"!==t.value.element)continue;let n=this.graph.vertices[t.neighbours[0]];n.value.hasHydrogen=!0,(!n.value.isStereoCenter||2>n.value.rings.length&&!n.value.bridgedRing||n.value.bridgedRing&&2>n.value.originalRings.length)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=[],o=this,a=function(e){let r=o.getRing(e);t.push(e);for(var s=0;s<r.neighbours.length;s++){let i=r.neighbours[s];-1===t.indexOf(i)&&i!==e&&m.isBridge(o.ringConnections,o.graph.vertices,e,i)&&a(i)}};return a(e),l.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let n=new Set,r=new Set,o=new Set;for(var a=0;a<e.length;a++){let t=this.getRing(e[a]);t.isPartOfBridged=!0;for(var s=0;s<t.members.length;s++)r.add(t.members[s]);for(var s=0;s<t.neighbours.length;s++){let n=t.neighbours[s];-1===e.indexOf(n)&&o.add(t.neighbours[s])}}let g=new Set;for(let i of r){let t=this.graph.vertices[i],r=l.intersection(e,t.value.rings);1===t.value.rings.length||1===r.length?n.add(t.id):g.add(t.id)}let d=[];for(let i of g){let e=this.graph.vertices[i],t=!1;for(let n=0;n<e.edges.length;n++)1===this.edgeRingCount(e.edges[n])&&(t=!0);t?(e.value.isBridgeNode=!0,n.add(e.id)):(e.value.isBridge=!0,n.add(e.id))}let h=new f([...n]);this.addRing(h),h.isBridged=!0,h.neighbours=[...o];for(var a=0;a<e.length;a++)h.rings.push(this.getRing(e[a]).clone());for(var a=0;a<h.members.length;a++)this.graph.vertices[h.members[a]].value.bridgedRing=h.id;for(var a=0;a<d.length;a++){let e=this.graph.vertices[d[a]];e.value.rings=[]}for(let i of n){let t=this.graph.vertices[i];t.value.rings=l.removeAll(t.value.rings,e),t.value.rings.push(h.id)}for(var a=0;a<e.length;a++)for(var s=a+1;s<e.length;s++)this.removeRingConnectionsBetween(e[a],e[s]);for(let n of o){let t=this.getRingConnections(n,e);for(var s=0;s<t.length;s++)this.getRingConnection(t[s]).updateOther(h.id,n);this.getRing(n).neighbours.push(h.id)}return h}areVerticesInSameRing(e,t){for(var n=0;n<e.value.rings.length;n++)for(var r=0;r<t.value.rings.length;r++)if(e.value.rings[n]===t.value.rings[r])return!0;return!1}getCommonRings(e,t){let n=[];for(var r=0;r<e.value.rings.length;r++)for(var o=0;o<t.value.rings.length;o++)e.value.rings[r]==t.value.rings[o]&&n.push(e.value.rings[r]);return n}getLargestOrAromaticCommonRing(e,t){let n=this.getCommonRings(e,t),r=0,o=null;for(var a=0;a<n.length;a++){let e=this.getRing(n[a]),t=e.getSize();if(e.isBenzeneLike(this.graph.vertices))return e;t>r&&(r=t,o=e)}return o}getVerticesAt(e,t,n){let r=[];for(var o=0;o<this.graph.vertices.length;o++){let i=this.graph.vertices[o];if(i.id===n||!i.positioned)continue;let a=e.distanceSq(i.position);a<=t*t&&r.push(i.id)}return r}getClosestVertex(e){let t=99999,n=null;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];if(i.id===e.id)continue;let o=e.position.distanceSq(i.position);o<t&&(t=o,n=i)}return n}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(t){return t.id!==e}),this.ringConnections=this.ringConnections.filter(function(t){return t.firstRingId!==e&&t.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let n=this.rings[t];n.neighbours=n.neighbours.filter(function(t){return t!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let n=[];for(var r=0;r<this.ringConnections.length;r++){let i=this.ringConnections[r];(i.firstRingId===e&&i.secondRingId===t||i.firstRingId===t&&i.secondRingId===e)&&n.push(i.id)}for(var r=0;r<n.length;r++)this.removeRingConnection(n[r])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let n=[];for(var r=0;r<this.ringConnections.length;r++){let i=this.ringConnections[r];for(var o=0;o<t.length;o++){let r=t[o];(i.firstRingId===e&&i.secondRingId===r||i.firstRingId===r&&i.secondRingId===e)&&n.push(i.id)}}return n}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var n=0;n<this.graph.vertices.length;n++)t[n]=0;for(var o,n=0;n<this.graph.vertices.length;n++)for(o=this.graph.vertices.length;--o>n;){let i=this.graph.vertices[n],a=this.graph.vertices[o];if(!i.value.isDrawn||!a.value.isDrawn)continue;let s=h.subtract(i.position,a.position).lengthSq();if(s<this.opts.bondLengthSq){let i=(this.opts.bondLength-r(s))/this.opts.bondLength;e+=i,t[n]+=i,t[o]+=i}}let a=[];for(var n=0;n<this.graph.vertices.length;n++)a.push({id:n,score:t[n]});return a.sort(function(e,t){return t.score-e.score}),{total:e,scores:a,vertexScores:t}}chooseSide(e,t,n){let r=e.getNeighbours(t.id),o=t.getNeighbours(e.id),a=r.length,s=o.length,g=l.merge(r,o),d=[0,0];for(var h=0;h<g.length;h++){let i=this.graph.vertices[g[h]].position;i.sameSideAs(e.position,t.position,n[0])?d[0]++:d[1]++}let c=[0,0];for(var h=0;h<this.graph.vertices.length;h++){let i=this.graph.vertices[h].position;i.sameSideAs(e.position,t.position,n[0])?c[0]++:c[1]++}return{totalSideCount:c,totalPosition:c[0]>c[1]?0:1,sideCount:d,position:d[0]>d[1]?0:1,anCount:a,bnCount:s}}setRingCenter(e){let t=e.getSize(),n=new h(0,0);for(var r=0;r<t;r++)n.add(this.graph.vertices[e.members[r]].position);e.center=n.divide(t)}getSubringCenter(e,t){let n=t.value.originalRings,r=e.center,o=Number.MAX_VALUE;for(var a=0;a<n.length;a++)for(var s=0;s<e.rings.length;s++)n[a]===e.rings[s].id&&e.rings[s].getSize()<o&&(r=e.rings[s].center,o=e.rings[s].getSize());return r}drawEdges(e){let t=this,n=Array(this.graph.edges.length);if(n.fill(!1),this.graph.traverseBF(0,function(r){let o=t.graph.getEdges(r.id);for(var a=0;a<o.length;a++){let i=o[a];n[i]||(n[i]=!0,t.drawEdge(i,e))}}),!this.bridgedRing)for(var r=0;r<this.rings.length;r++){let e=this.rings[r];this.isRingAromatic(e)&&this.canvasWrapper.drawAromaticityRing(e)}}drawEdge(e,t){let n=this,i=this.graph.edges[e],r=this.graph.vertices[i.sourceId],o=this.graph.vertices[i.targetId],s=r.value.element,g=o.value.element;if((!r.value.isDrawn||!o.value.isDrawn)&&"default"===this.opts.atomVisualization)return;let d=r.position,a=o.position,p=this.getEdgeNormals(i),u=l.clone(p);if(u[0].multiplyScalar(10).add(d),u[1].multiplyScalar(10).add(d),"="===i.bondType||"="===this.getRingbondType(r,o)||i.isPartOfAromaticRing&&this.bridgedRing){let e=this.areVerticesInSameRing(r,o),t=this.chooseSide(r,o,u);if(e){let e=this.getLargestOrAromaticCommonRing(r,o),t=e.center;p[0].multiplyScalar(n.opts.bondSpacing),p[1].multiplyScalar(n.opts.bondSpacing);let l=null;l=t.sameSideAs(r.position,o.position,h.add(d,p[0]))?new c(h.add(d,p[0]),h.add(a,p[0]),s,g):new c(h.add(d,p[1]),h.add(a,p[1]),s,g),l.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(l,!0):this.canvasWrapper.drawLine(l),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(i.center||r.isTerminal()&&o.isTerminal()){p[0].multiplyScalar(n.opts.halfBondSpacing),p[1].multiplyScalar(n.opts.halfBondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t)}else if(0==t.anCount&&1<t.bnCount||0==t.bnCount&&1<t.anCount){p[0].multiplyScalar(n.opts.halfBondSpacing),p[1].multiplyScalar(n.opts.halfBondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t)}else if(t.sideCount[0]>t.sideCount[1]){p[0].multiplyScalar(n.opts.bondSpacing),p[1].multiplyScalar(n.opts.bondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.sideCount[0]<t.sideCount[1]){p[0].multiplyScalar(n.opts.bondSpacing),p[1].multiplyScalar(n.opts.bondSpacing);let e=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.totalSideCount[0]>t.totalSideCount[1]){p[0].multiplyScalar(n.opts.bondSpacing),p[1].multiplyScalar(n.opts.bondSpacing);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if(t.totalSideCount[0]<=t.totalSideCount[1]){p[0].multiplyScalar(n.opts.bondSpacing),p[1].multiplyScalar(n.opts.bondSpacing);let e=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);e.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(new c(d,a,s,g))}else;}else if("#"===i.bondType){p[0].multiplyScalar(n.opts.bondSpacing/1.5),p[1].multiplyScalar(n.opts.bondSpacing/1.5);let e=new c(h.add(d,p[0]),h.add(a,p[0]),s,g),t=new c(h.add(d,p[1]),h.add(a,p[1]),s,g);this.canvasWrapper.drawLine(e),this.canvasWrapper.drawLine(t),this.canvasWrapper.drawLine(new c(d,a,s,g))}else if("."===i.bondType);else{let e=r.value.isStereoCenter,t=o.value.isStereoCenter;"up"===i.wedge?this.canvasWrapper.drawWedge(new c(d,a,s,g,e,t)):"down"===i.wedge?this.canvasWrapper.drawDashedWedge(new c(d,a,s,g,e,t)):this.canvasWrapper.drawLine(new c(d,a,s,g,e,t))}if(t){let t=h.midpoint(d,a);this.canvasWrapper.drawDebugText(t.x,t.y,"e: "+e)}}drawVertices(e){for(var t=Math.abs,n=this.graph.vertices.length,n=0;n<this.graph.vertices.length;n++){let i=this.graph.vertices[n],r=i.value,a=0,s=0,g=i.value.bondCount,d=r.element,c=v.maxBonds[d]-g,p=i.getTextDirection(this.graph.vertices),u=!!(this.opts.terminalCarbons||"C"!==d||r.hasAttachedPseudoElements)&&i.isTerminal(),f="C"===r.element;if("N"===r.element&&r.isPartOfAromaticRing&&(c=0),r.bracket&&(c=r.bracket.hcount,a=r.bracket.charge,s=r.bracket.isotope),"allballs"===this.opts.atomVisualization)this.canvasWrapper.drawBall(i.position.x,i.position.y,d);else if(r.isDrawn&&(!f||r.drawExplicit||u||r.hasAttachedPseudoElements)||1===this.graph.vertices.length)"default"===this.opts.atomVisualization?this.canvasWrapper.drawText(i.position.x,i.position.y,d,c,p,u,a,s,r.getAttachedPseudoElements()):"balls"===this.opts.atomVisualization&&this.canvasWrapper.drawBall(i.position.x,i.position.y,d);else if(2===i.getNeighbourCount()&&!0==i.forcePositioned){let e=this.graph.vertices[i.neighbours[0]].position,n=this.graph.vertices[i.neighbours[1]].position,r=h.threePointangle(i.position,e,n);.1>t(o-r)&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,d)}if(e){let e="v: "+i.id+" "+l.print(r.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,e)}else;}if(this.opts.debug)for(var n=0;n<this.rings.length;n++){let e=this.rings[n].center;this.canvasWrapper.drawDebugPoint(e.x,e.y,"r: "+this.rings[n].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(null!==this.graph.vertices[t].value.bridgedRing){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);0<this.rings.length&&null===e&&(e=this.graph.vertices[this.rings[0].members[0]]),null===e&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=[],this.originalRingConnections=[];for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=[],this.ringConnections=[];for(var t=0;t<e.length;t++){let i=e[t];for(var n=0;n<i.rings.length;n++){let e=i.rings[n];this.originalRings[e.id].center=e.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,o=null){if(e.positioned)return;t=t?t:new h(0,0);let s=e.getOrderedNeighbours(this.ringConnections),g=r?h.subtract(r.position,t).angle():0,l=d.polyCircumradius(this.opts.bondLength,e.getSize()),c=d.centralAngle(e.getSize());e.centralAngle=c;let p=g,u=this,v=r?r.id:null;if(-1===e.members.indexOf(v)&&(r&&(r.positioned=!1),v=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var f=0;f<e.rings.length;f++)this.setRingCenter(e.rings[f])}else e.eachMember(this.graph.vertices,function(r){let o=u.graph.vertices[r];o.positioned||o.setPosition(t.x+i(p)*l,t.y+n(p)*l),p+=c,(!e.isBridged||3>e.rings.length)&&(o.angle=p,o.positioned=!0)},v,o?o.id:null);e.positioned=!0,e.center=t;for(var f=0;f<s.length;f++){let n=this.getRing(s[f].neighbour);if(n.positioned)continue;let i=m.getVertices(this.ringConnections,e.id,n.id);if(2===i.length){e.isFused=!0,n.isFused=!0;let o=this.graph.vertices[i[0]],a=this.graph.vertices[i[1]],s=h.midpoint(o.position,a.position),g=h.normals(o.position,a.position);g[0].normalize(),g[1].normalize();let l=d.polyCircumradius(this.opts.bondLength,n.getSize()),r=d.apothem(l,n.getSize());g[0].multiplyScalar(r).add(s),g[1].multiplyScalar(r).add(s);let c=g[0];h.subtract(t,g[1]).lengthSq()>h.subtract(t,g[0]).lengthSq()&&(c=g[1]);let p=h.subtract(o.position,c),u=h.subtract(a.position,c);-1===p.clockwise(u)?!n.positioned&&this.createRing(n,c,o,a):!n.positioned&&this.createRing(n,c,a,o)}else if(1===i.length){e.isSpiro=!0,n.isSpiro=!0;let o=this.graph.vertices[i[0]],a=h.subtract(t,o.position);a.invert(),a.normalize();let s=d.polyCircumradius(this.opts.bondLength,n.getSize());a.multiplyScalar(s),a.add(o.position),n.positioned||this.createRing(n,a,o)}}for(var f=0;f<e.members.length;f++){let t=this.graph.vertices[e.members[f]],n=t.neighbours;for(var b=0;b<n.length;b++){let e=this.graph.vertices[n[b]];e.positioned||(e.value.isConnectedToRing=!0,this.createNextBond(e,t,0))}}}rotateSubtree(e,t,n,r){let o=this;this.graph.traverseTree(e,t,function(e){e.position.rotateAround(n,r);for(var t=0;t<e.value.anchoredRings.length;t++){let i=o.rings[e.value.anchoredRings[t]];i&&i.center.rotateAround(n,r)}})}getSubtreeOverlapScore(e,t,n){let i=this,r=0,o=new h(0,0),a=0;return this.graph.traverseTree(e,t,function(e){if(e.value.isDrawn){let t=n[e.id];t>i.opts.overlapSensitivity&&(r+=t,a++);let s=i.graph.vertices[e.id].position.clone();s.multiplyScalar(t),o.add(s)}}),o.divide(r),{value:r/a,center:o}}getCurrentCenterOfMass(){let e=new h(0,0),t=0;for(var n=0;n<this.graph.vertices.length;n++){let i=this.graph.vertices[n];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=2*this.opts.bondLength){let n=new h(0,0),r=0;for(var o=0;o<this.graph.vertices.length;o++){let i=this.graph.vertices[o];i.positioned&&e.distanceSq(i.position)<t*t&&(n.add(i.position),r++)}return n.divide(r)}resolvePrimaryOverlaps(){let e=[],t=Array(this.graph.vertices.length);for(var n=0;n<this.rings.length;n++){let i=this.rings[n];for(var r=0;r<i.members.length;r++){let n=this.graph.vertices[i.members[r]];if(t[n.id])continue;t[n.id]=!0;let o=this.getNonRingNeighbours(n.id);if(1<o.length){let t=[];for(var a=0;a<n.value.rings.length;a++)t.push(n.value.rings[a]);e.push({common:n,rings:t,vertices:o})}else if(1===o.length&&2===n.value.rings.length){let t=[];for(var a=0;a<n.value.rings.length;a++)t.push(n.value.rings[a]);e.push({common:n,rings:t,vertices:o})}}}for(var n=0;n<e.length;n++){let t=e[n];if(2===t.vertices.length){let e=t.vertices[0],n=t.vertices[1];if(!e.value.isDrawn||!n.value.isDrawn)continue;let i=(2*o-this.getRing(t.rings[0]).getAngle())/6;this.rotateSubtree(e.id,t.common.id,i,t.common.position),this.rotateSubtree(n.id,t.common.id,-i,t.common.position);let r=this.getOverlapScore(),a=this.getSubtreeOverlapScore(e.id,t.common.id,r.vertexScores),s=this.getSubtreeOverlapScore(n.id,t.common.id,r.vertexScores),g=a.value+s.value;this.rotateSubtree(e.id,t.common.id,-2*i,t.common.position),this.rotateSubtree(n.id,t.common.id,2*i,t.common.position),r=this.getOverlapScore(),a=this.getSubtreeOverlapScore(e.id,t.common.id,r.vertexScores),s=this.getSubtreeOverlapScore(n.id,t.common.id,r.vertexScores),a.value+s.value>g&&(this.rotateSubtree(e.id,t.common.id,2*i,t.common.position),this.rotateSubtree(n.id,t.common.id,-2*i,t.common.position))}else 1!==t.vertices.length||2!==t.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let n=this.graph.vertices[e[t].id];if(n.isTerminal()){let e=this.getClosestVertex(n);if(e){let t=null;t=e.isTerminal()?0===e.id?this.graph.vertices[1].position:e.previousPosition:0===e.id?this.graph.vertices[1].position:e.position;let i=0===n.id?this.graph.vertices[1].position:n.previousPosition;n.position.rotateAwayFrom(t,i,d.toRad(20))}}}}getLastVertexWithAngle(e){let t=0,n=null;for(;!t&&e;)n=this.graph.vertices[e],t=n.angle,e=n.parentVertexId;return n}createNextBond(e,t=null,n=0,r=!1,o=!1){if(e.positioned&&!o)return;let c=!1;if(t){let n=this.graph.getEdge(e.id,t.id);("/"===n.bondType||"\\"===n.bondType)&&1==++this.doubleBondConfigCount%2&&null===this.doubleBondConfig&&(this.doubleBondConfig=n.bondType,c=!0,null===t.parentVertexId&&e.value.branchBond&&("/"===this.doubleBondConfig?this.doubleBondConfig="\\":"\\"===this.doubleBondConfig&&(this.doubleBondConfig="/")))}if(!o)if(!t){let t=new h(this.opts.bondLength,0);t.rotate(d.toRad(-60)),e.previousPosition=t,e.setPosition(this.opts.bondLength,0),e.angle=d.toRad(-60),null===e.value.bridgedRing&&(e.positioned=!0)}else if(0<t.value.rings.length){let n=t.neighbours,i=null,r=new h(0,0);if(null===t.value.bridgedRing&&1<t.value.rings.length)for(var p=0;p<n.length;p++){let e=this.graph.vertices[n[p]];if(l.containsAll(e.value.rings,t.value.rings)){i=e;break}}if(null===i){for(var p=0;p<n.length;p++){let e=this.graph.vertices[n[p]];e.positioned&&this.areVerticesInSameRing(e,t)&&r.add(h.subtract(e.position,t.position))}r.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else r=i.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(r),e.positioned=!0}else{let i=new h(this.opts.bondLength,0);i.rotate(n),i.add(t.position),e.setPositionFromVector(i),e.previousPosition=t.position,e.positioned=!0}if(null!==e.value.bridgedRing){let t=this.getRing(e.value.bridgedRing);if(!t.positioned){let n=h.subtract(e.previousPosition,e.position);n.invert(),n.normalize();let i=d.polyCircumradius(this.opts.bondLength,t.members.length);n.multiplyScalar(i),n.add(e.position),this.createRing(t,n,e)}}else if(0<e.value.rings.length){let t=this.getRing(e.value.rings[0]);if(!t.positioned){let n=h.subtract(e.previousPosition,e.position);n.invert(),n.normalize();let i=d.polyCircumradius(this.opts.bondLength,t.getSize());n.multiplyScalar(i),n.add(e.position),this.createRing(t,n,e)}}else{let n=e.value.isStereoCenter,i=e.getNeighbours(),o=[];for(var p=0;p<i.length;p++)this.graph.vertices[i[p]].value.isDrawn&&o.push(i[p]);t&&(o=l.remove(o,t.id));let u=e.getAngle();if(1===o.length){let n=this.graph.vertices[o[0]];if("#"===e.value.bondType||t&&"#"===t.value.bondType||"="===e.value.bondType&&t&&0===t.value.rings.length&&"="===t.value.bondType&&"-"!==e.value.branchBond){if(e.value.drawExplicit=!1,t){let n=this.graph.getEdge(e.id,t.id);n.center=!0}let i=this.graph.getEdge(e.id,n.id);i.center=!0,("#"===e.value.bondType||t&&"#"===t.value.bondType)&&(n.angle=0),n.drawExplicit=!0,this.createNextBond(n,e,u+n.angle)}else if(t&&0<t.value.rings.length){let t=d.toRad(60),i=-t,r=new h(this.opts.bondLength,0),o=new h(this.opts.bondLength,0);r.rotate(t).add(e.position),o.rotate(i).add(e.position);let a=this.getCurrentCenterOfMass(),s=r.distanceSq(a),g=o.distanceSq(a);n.angle=s<g?i:t,this.createNextBond(n,e,u+n.angle)}else{let i=e.angle;if(t&&3<t.neighbours.length)i=0<i?s(1.0472,i):0>i?g(-1.0472,i):1.0472;else if(!i){let t=this.getLastVertexWithAngle(e.id);i=t.angle,i||(i=1.0472)}if(t&&!c){let t=this.graph.getEdge(e.id,n.id).bondType;"/"===t?("/"===this.doubleBondConfig||"\\"===this.doubleBondConfig&&(i=-i),this.doubleBondConfig=null):"\\"===t&&("/"===this.doubleBondConfig?i=-i:"\\"===this.doubleBondConfig,this.doubleBondConfig=null)}n.angle=r?i:-i,this.createNextBond(n,e,u+n.angle)}}else if(2===o.length){let n=e.angle;n||(n=1.0472);let i=this.graph.getTreeDepth(o[0],e.id),a=this.graph.getTreeDepth(o[1],e.id),s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]];s.value.subtreeDepth=i,g.value.subtreeDepth=a;let r=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=r);let d=0,l=1;"C"===g.value.element&&"C"!==s.value.element&&1<a&&5>i?(d=1,l=0):"C"!==g.value.element&&"C"===s.value.element&&1<i&&5>a?(d=0,l=1):a>i&&(d=1,l=0);let h=this.graph.vertices[o[d]],c=this.graph.vertices[o[l]],p=this.graph.getEdge(e.id,h.id),v=this.graph.getEdge(e.id,c.id),f=!1;r<i&&r<a&&(f=!0),c.angle=n,h.angle=-n,"\\"===this.doubleBondConfig?"\\"===c.value.branchBond&&(c.angle=-n,h.angle=n):"/"===this.doubleBondConfig&&"/"===c.value.branchBond&&(c.angle=-n,h.angle=n),this.createNextBond(c,e,u+c.angle,f),this.createNextBond(h,e,u+h.angle,f)}else if(3===o.length){let n=this.graph.getTreeDepth(o[0],e.id),i=this.graph.getTreeDepth(o[1],e.id),a=this.graph.getTreeDepth(o[2],e.id),g=this.graph.vertices[o[0]],s=this.graph.vertices[o[1]],l=this.graph.vertices[o[2]];g.value.subtreeDepth=n,s.value.subtreeDepth=i,l.value.subtreeDepth=a,i>n&&i>a?(g=this.graph.vertices[o[1]],s=this.graph.vertices[o[0]],l=this.graph.vertices[o[2]]):a>n&&a>i&&(g=this.graph.vertices[o[2]],s=this.graph.vertices[o[0]],l=this.graph.vertices[o[1]]),t&&1>t.value.rings.length&&1>g.value.rings.length&&1>s.value.rings.length&&1>l.value.rings.length&&1===this.graph.getTreeDepth(s.id,e.id)&&1===this.graph.getTreeDepth(l.id,e.id)&&1<this.graph.getTreeDepth(g.id,e.id)?(g.angle=-e.angle,0<=e.angle?(s.angle=d.toRad(30),l.angle=d.toRad(90)):(s.angle=-d.toRad(30),l.angle=-d.toRad(90)),this.createNextBond(g,e,u+g.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(l,e,u+l.angle)):(g.angle=0,s.angle=d.toRad(90),l.angle=-d.toRad(90),this.createNextBond(g,e,u+g.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(l,e,u+l.angle))}else if(4===o.length){let t=this.graph.getTreeDepth(o[0],e.id),n=this.graph.getTreeDepth(o[1],e.id),i=this.graph.getTreeDepth(o[2],e.id),r=this.graph.getTreeDepth(o[3],e.id),a=this.graph.vertices[o[0]],s=this.graph.vertices[o[1]],g=this.graph.vertices[o[2]],l=this.graph.vertices[o[3]];a.value.subtreeDepth=t,s.value.subtreeDepth=n,g.value.subtreeDepth=i,l.value.subtreeDepth=r,n>t&&n>i&&n>r?(a=this.graph.vertices[o[1]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[2]],l=this.graph.vertices[o[3]]):i>t&&i>n&&i>r?(a=this.graph.vertices[o[2]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]],l=this.graph.vertices[o[3]]):r>t&&r>n&&r>i&&(a=this.graph.vertices[o[3]],s=this.graph.vertices[o[0]],g=this.graph.vertices[o[1]],l=this.graph.vertices[o[2]]),a.angle=-d.toRad(36),s.angle=d.toRad(36),g.angle=-d.toRad(108),l.angle=d.toRad(108),this.createNextBond(a,e,u+a.angle),this.createNextBond(s,e,u+s.angle),this.createNextBond(g,e,u+g.angle),this.createNextBond(l,e,u+l.angle)}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var n=0;n<t.length;n++){let i=this.graph.vertices[t[n]];if(l.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let n=this.rings[t];if(!n.positioned)continue;let i=d.polyCircumradius(this.opts.bondLength,n.getSize());if(e.distanceSq(n.center)<i*i)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],n=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,n)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],n=this.graph.vertices[e.targetId];return!("-"!==e.bondType)&&!(t.isTerminal()||n.isTerminal())&&!(0<t.value.rings.length&&0<n.value.rings.length&&this.areVerticesInSameRing(t,n))}isRingAromatic(e){for(var t=0;t<e.members.length;t++){let n=this.graph.vertices[e.members[t]];if(!n.value.isPartOfAromaticRing)return!1}return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,n=this.graph.vertices[e.targetId].position,i=h.units(t,n);return i}getNonRingNeighbours(e){let t=[],n=this.graph.vertices[e],r=n.neighbours;for(var o=0;o<r.length;o++){let e=this.graph.vertices[r[o]],i=l.intersection(n.value.rings,e.value.rings).length;0===i&&!1==e.value.isBridge&&t.push(e)}return t}annotateStereochemistry(){for(var e=0;e<this.graph.vertices.length;e++){let i=this.graph.vertices[e];if(!i.value.isStereoCenter)continue;let o=i.getNeighbours(),a=o.length,s=Array(a);for(var t=0;t<a;t++){let e=new Uint8Array(this.graph.vertices.length),r=[[]];e[i.id]=1,this.visitStereochemistry(o[t],i.id,e,r,10,0);for(var n=0;n<r.length;n++)r[n].sort(function(e,t){return t-e});s[t]=[t,r]}let g=0,l=0;for(var t=0;t<s.length;t++){s[t][1].length>g&&(g=s[t][1].length);for(var n=0;n<s[t][1].length;n++)s[t][1][n].length>l&&(l=s[t][1][n].length)}for(var t=0;t<s.length;t++){let e=g-s[t][1].length;for(var n=0;n<e;n++)s[t][1].push([]);s[t][1].push([o[t]]);for(var n=0;n<s[t][1].length;n++){let e=l-s[t][1][n].length;for(var r=0;r<e;r++)s[t][1][n].push(0)}}s.sort(function(e,t){for(var n=0;n<e[1].length;n++)for(var i=0;i<e[1][n].length;i++){if(e[1][n][i]>t[1][n][i])return-1;if(e[1][n][i]<t[1][n][i])return 1}return 0});let h=new Uint8Array(a);for(var t=0;t<a;t++)h[t]=s[t][0],i.value.priority=t;let c=this.graph.vertices[o[h[0]]].position,p=this.graph.vertices[o[h[1]]].position,u=this.graph.vertices[o[h[2]]].position,v=c.relativeClockwise(p,i.position),f=c.relativeClockwise(u,i.position),m=-1===v,b="@"===i.value.bracket.chirality?-1:1,x=1==d.parityOfPermutation(h)*b?"R":"S",y="down",S="up";(m&&"R"!==x||!m&&"S"!==x)&&(i.value.hydrogenDirection="up",y="up",S="down"),i.value.hasHydrogen&&(this.graph.getEdge(i.id,o[h[h.length-1]]).wedge=y);let C=Array(o.length-1),R=1<i.value.rings.length&&i.value.hasHydrogen,A=i.value.hasHydrogen?1:0;for(var t=0;t<h.length-A;t++){C[t]=new Uint32Array(2);let e=this.graph.vertices[o[h[t]]];C[t][0]+=e.value.isStereoCenter?0:1e5,C[t][0]+=this.areVerticesInSameRing(e,i)?0:1e4,C[t][0]+=e.value.isHeteroAtom()?1e3:0,C[t][0]-=0===e.value.subtreeDepth?1e3:0,C[t][0]+=1e3-e.value.subtreeDepth,C[t][1]=o[h[t]]}if(C.sort(function(e,t){return e[0]>t[0]?-1:e[0]<t[0]?1:0}),!R){let e=C[0][1];if(i.value.hasHydrogen)this.graph.getEdge(i.id,e).wedge=S;else{let n=S;for(var t=h.length-1;0<=t&&(n=n===y?S:y,o[h[t]]!==e);t--);this.graph.getEdge(i.id,e).wedge=n}}i.value.chirality=x}}visitStereochemistry(e,t,n,r,o,a,s=0){n[e]=1;let g=this.graph.vertices[e],d=g.value.getAtomicNumber();r.length<=a&&r.push([]);for(var l=0;l<this.graph.getEdge(e,t).weight;l++)r[a].push(1e3*s+d);let h=this.graph.vertices[e].neighbours;for(var l=0;l<h.length;l++)1!==n[h[l]]&&a<o-1&&this.visitStereochemistry(h[l],e,n.slice(),r,o,a+1,d);if(a<o-1){let t=0;for(var l=0;l<h.length;l++)t+=this.graph.getEdge(e,h[l]).weight;for(var l=0;l<g.value.getMaxBonds()-t;l++)r.length<=a+1&&r.push([]),r[a+1].push(1e3*d+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){const n=this.graph.vertices[e],i=n.neighbours;let r=Array(i.length);for(var t=0;t<i.length;t++)r[t]=this.graph.vertices[i[t]];if(3>n.getNeighbourCount()||0<n.value.rings.length)continue;if("P"===n.value.element)continue;if("C"===n.value.element&&3===r.length&&"N"===r[0].value.element&&"N"===r[1].value.element&&"N"===r[2].value.element)continue;let o=0,a=0;for(var t=0;t<r.length;t++){let e=r[t],n=e.value.element,i=e.getNeighbourCount();"C"!==n&&"H"!==n&&1===i&&o++,1<i&&a++}if(1<a||2>o)continue;let s=null;for(var t=0;t<r.length;t++){let e=r[t];1<e.getNeighbourCount()&&(s=e)}for(var t=0;t<r.length;t++){let e=r[t];if(1<e.getNeighbourCount())continue;e.value.isDrawn=!1;let i=v.maxBonds[e.value.element]-e.value.bondCount,o="";e.value.bracket&&(i=e.value.bracket.hcount,o=e.value.bracket.charge||0),n.value.attachPseudoElement(e.value.element,s?s.value.element:null,i,o)}}for(var e=0;e<this.graph.vertices.length;e++){const n=this.graph.vertices[e],i=n.value,r=i.element;if("C"===r||"H"===r||!i.isDrawn)continue;const o=n.neighbours;let a=Array(o.length);for(var t=0;t<o.length;t++)a[t]=this.graph.vertices[o[t]];for(var t=0;t<a.length;t++){let e=a[t].value;if(!e.hasAttachedPseudoElements||2!==e.getAttachedPseudoElementsCount())continue;const i=e.getAttachedPseudoElements();i.hasOwnProperty("0O")&&i.hasOwnProperty("3C")&&(e.isDrawn=!1,n.value.attachPseudoElement("Ac","",0))}}}}},{"./ArrayHelper":2,"./Atom":3,"./CanvasWrapper":4,"./Edge":6,"./Graph":7,"./Line":8,"./MathHelper":9,"./Ring":11,"./RingConnection":12,"./SSSR":13,"./Vector2":14,"./Vertex":15}],6:[function(e,t){"use strict";class n{constructor(e,t,n=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=n,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=n.bonds[e]}static get bonds(){return{"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}}t.exports=n},{}],7:[function(e,t){"use strict";var n=Math.pow,r=Math.sqrt,o=Math.min;const s=e("./MathHelper"),g=e("./Vector2"),d=e("./Vertex"),l=e("./Edge"),h=e("./Ring"),c=e("./Atom");class p{constructor(e,t=!1){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={},this.isomeric=t,this._time=0,this._init(e)}_init(e,t=0,n=null,r=!1){let o=new c(e.atom.element?e.atom.element:e.atom,e.bond);o.branchBond=e.branchBond,o.ringbonds=e.ringbonds,o.bracket=e.atom.element?e.atom:null;let a=new d(o),s=this.vertices[n];if(this.addVertex(a),null!==n){a.setParentVertexId(n),a.value.addNeighbouringElement(s.value.element),s.addChild(a.id),s.value.addNeighbouringElement(o.element),s.spanningTreeChildren.push(a.id);let e=new l(n,a.id,1),t=null;r?(e.setBondType(a.value.branchBond||"-"),t=a.id,e.setBondType(a.value.branchBond||"-"),t=a.id):(e.setBondType(s.value.bondType||"-"),t=s.id);this.addEdge(e)}let g=e.ringbondCount+1;o.bracket&&(g+=o.bracket.hcount);let h=0;if(o.bracket&&o.bracket.chirality){o.isStereoCenter=!0,h=o.bracket.hcount;for(var p=0;p<h;p++)this._init({atom:"H",isBracket:"false",branches:[],branchCount:0,ringbonds:[],ringbondCount:!1,next:null,hasNext:!1,bond:"-"},p,a.id,!0)}for(var p=0;p<e.branchCount;p++)this._init(e.branches[p],p+g,a.id,!0);e.hasNext&&this._init(e.next,e.branchCount+g,a.id)}clear(){this.vertices=[],this.edges=[],this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],n=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&n.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,n.value.bondCount+=e.weight,t.edges.push(e.id),n.edges.push(e.id),e.id}getEdge(e,t){let n=this.vertexIdsToEdgeId[e+"_"+t];return n===void 0?null:this.edges[n]}getEdges(e){let t=[],n=this.vertices[e];for(var r=0;r<n.neighbours.length;r++)t.push(this.vertexIdsToEdgeId[e+"_"+n.neighbours[r]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var n=0;n<e;n++)t[n]=Array(e),t[n].fill(0);for(var n=0;n<this.edges.length;n++){let e=this.edges[n];t[e.sourceId][e.targetId]=1,t[e.targetId][e.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),n=this.getBridges();for(var r=0;r<e;r++)t[r]=Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let e=this.edges[r];t[e.sourceId][e.targetId]=1,t[e.targetId][e.sourceId]=1}for(var r=0;r<n.length;r++)t[n[r][0]][n[r][1]]=0,t[n[r][1]][n[r][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,n=Array(t);for(var r=0;r<t;r++){n[r]=Array(t),n[r].fill(0);for(var o=0;o<t;o++)r!=o&&this.hasEdge(e[r],e[o])&&(n[r][o]=1)}return n}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),n=Array(e);for(var r=0;r<e;r++)n[r]=Array(e),n[r].fill(1/0);for(var r=0;r<e;r++)for(var o=0;o<e;o++)1===t[r][o]&&(n[r][o]=1);for(var a=0;a<e;a++)for(var r=0;r<e;r++)for(var o=0;o<e;o++)n[r][o]>n[r][a]+n[a][o]&&(n[r][o]=n[r][a]+n[a][o]);return n}getSubgraphDistanceMatrix(e){let t=e.length,n=this.getSubgraphAdjacencyMatrix(e),r=Array(t);for(var o=0;o<t;o++)r[o]=Array(t),r[o].fill(1/0);for(var o=0;o<t;o++)for(var a=0;a<t;a++)1===n[o][a]&&(r[o][a]=1);for(var s=0;s<t;s++)for(var o=0;o<t;o++)for(var a=0;a<t;a++)r[o][a]>r[o][s]+r[s][a]&&(r[o][a]=r[o][s]+r[s][a]);return r}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var n=0;n<e;n++){t[n]=[];for(var r=0;r<e;r++)n!=r&&this.hasEdge(this.vertices[n].id,this.vertices[r].id)&&t[n].push(r)}return t}getSubgraphAdjacencyList(e){let t=e.length,n=Array(t);for(var r=0;r<t;r++){n[r]=[];for(var o=0;o<t;o++)r!=o&&this.hasEdge(e[r],e[o])&&n[r].push(o)}return n}getBridges(){let e=this.vertices.length,t=Array(e),n=Array(e),r=Array(e),o=Array(e),a=this.getAdjacencyList(),s=[];t.fill(!1),o.fill(null),this._time=0;for(var g=0;g<e;g++)t[g]||this._bridgeDfs(g,t,n,r,o,a,s);return s}traverseBF(e,t){let n=this.vertices.length,r=Array(n);r.fill(!1);for(var o=[e];0<o.length;){let e=o.shift(),n=this.vertices[e];t(n);for(var a=0;a<n.neighbours.length;a++){let e=n.neighbours[a];r[e]||(r[e]=!0,o.push(e))}}}getTreeDepth(e,t){if(null===e||null===t)return 0;let n=this.vertices[e].getSpanningTreeNeighbours(t),r=0;for(var o=0;o<n.length;o++){let t=n[o],i=this.getTreeDepth(t,e);i>r&&(r=i)}return r+1}traverseTree(e,t,n,r=g,o=!1,a=1,s=null){var g=Number.MAX_SAFE_INTEGER;if(null===s&&(s=new Uint8Array(this.vertices.length)),a>r+1||1===s[e])return;s[e]=1;let d=this.vertices[e],l=d.getNeighbours(t);(!o||1<a)&&n(d);for(var h=0;h<l.length;h++)this.traverseTree(l[h],e,n,r,o,a+1,s)}kkLayout(e,t,o,g,d,l=.1,h=.1,c=2e3,p=50,u=1e9){for(var v=e.length;v--;){let t=this.vertices[e[v]];var f=t.neighbours.length}let m=this.getSubgraphDistanceMatrix(e),b=e.length,x=s.polyCircumradius(500,b),y=s.centralAngle(b),S=0,C=new Float32Array(b),R=new Float32Array(b),A=Array(b);for(v=b;v--;){let n=this.vertices[e[v]];n.positioned?(C[v]=n.position.x,R[v]=n.position.y):(C[v]=t.x+Math.cos(S)*x,R[v]=t.y+Math.sin(S)*x),A[v]=n.positioned,S+=y}let T=Array(b);for(v=b;v--;){T[v]=Array(b);for(var f=b;f--;)T[v][f]=d*m[v][f]}let k=Array(b);for(v=b;v--;){k[v]=Array(b);for(var f=b;f--;)k[v][f]=d*n(m[v][f],-2)}let I=Array(b),B=new Float32Array(b),w=new Float32Array(b);for(v=b;v--;)I[v]=Array(b);v=b;for(let n,i,a,s,f,m,x;v--;){n=C[v],i=R[v],a=0,s=0;for(let e=b;e--;)v!==e&&(f=C[e],m=R[e],x=1/r((n-f)*(n-f)+(i-m)*(i-m)),I[v][e]=[k[v][e]*(n-f-T[v][e]*(n-f)*x),k[v][e]*(i-m-T[v][e]*(i-m)*x)],I[e][v]=I[v][e],a+=I[v][e][0],s+=I[v][e][1]);B[v]=a,w[v]=s}let P=function(e){return[B[e]*B[e]+w[e]*w[e],B[e],w[e]]},L=function(){let e=0,t=0,n=0,i=0;for(v=b;v--;){let[r,o,a]=P(v);r>e&&!1===A[v]&&(e=r,t=v,n=o,i=a)}return[t,e,n,i]},E=function(e,t,i){let o=0,a=0,s=0,g=C[e],d=R[e],h=T[e],c=k[e];for(v=b;v--;){if(v===e)continue;let t=C[v],i=R[v],r=h[v],l=c[v],p=(g-t)*(g-t),u=1/n(p+(d-i)*(d-i),1.5);o+=l*(1-r*(d-i)*(d-i)*u),a+=l*(1-r*p*u),s+=l*(r*(g-t)*(d-i)*u)}0==o&&(o=.1),0===a&&(a=.1),0===s&&(s=.1);let p=t/o+i/s;p/=s/o-a/s;let l=-(s*p+t)/o;C[e]+=l,R[e]+=p;let u=I[e];t=0,i=0,g=C[e],d=R[e];let f,m,x,y,S;for(v=b;v--;)e!==v&&(f=C[v],m=R[v],x=u[v][0],y=u[v][1],S=1/r((g-f)*(g-f)+(d-m)*(d-m)),l=c[v]*(g-f-h[v]*(g-f)*S),p=c[v]*(d-m-h[v]*(d-m)*S),u[v]=[l,p],t+=l,i+=p,B[v]+=l-x,w[v]+=p-y);B[e]=t,w[e]=i},O=0,H=0,D=0,N=0,V=0,z=0;for(;u>l&&c>V;)for(V++,[O,u,H,D]=L(),N=u,z=0;N>h&&p>z;)z++,E(O,H,D),[N,H,D]=P(O);for(v=b;v--;){let t=e[v],n=this.vertices[t];n.position.x=C[v],n.position.y=R[v],n.positioned=!0,n.forcePositioned=!0}}_bridgeDfs(e,t,n,r,a,s,g){t[e]=!0,n[e]=r[e]=++this._time;for(var d=0;d<s[e].length;d++){let i=s[e][d];t[i]?i!==a[e]&&(r[e]=o(r[e],n[i])):(a[i]=e,this._bridgeDfs(i,t,n,r,a,s,g),r[e]=o(r[e],r[i]),r[i]>n[e]&&g.push([e,i]))}}static getConnectedComponents(e){let t=e.length,n=Array(t),i=[],r=0;n.fill(!1);for(var o=0;o<t;o++)if(!n[o]){let t=[];n[o]=!0,t.push(o),r++,p._ccGetDfs(o,n,e,t),1<t.length&&i.push(t)}return i}static getConnectedComponentCount(e){let t=e.length,n=Array(t),i=0;n.fill(!1);for(var r=0;r<t;r++)n[r]||(n[r]=!0,i++,p._ccCountDfs(r,n,e));return i}static _ccCountDfs(e,t,n){for(var i=0;i<n[e].length;i++){let r=n[e][i];r&&!t[i]&&e!==i&&(t[i]=!0,p._ccCountDfs(i,t,n))}}static _ccGetDfs(e,t,n,i){for(var r=0;r<n[e].length;r++){let o=n[e][r];o&&!t[r]&&e!==r&&(t[r]=!0,i.push(r),p._ccGetDfs(r,t,n,i))}}}t.exports=p},{"./Atom":3,"./Edge":6,"./MathHelper":9,"./Ring":11,"./Vector2":14,"./Vertex":15}],8:[function(e,t){"use strict";var n=Math.pow,i=Math.sin,o=Math.cos;const a=e("./Vector2");class s{constructor(e=new a(0,0),t=new a(0,0),n=null,i=null,r=!1,o=!1){this.from=e,this.to=t,this.elementFrom=n,this.elementTo=i,this.chiralFrom=r,this.chiralTo=o}clone(){return new s(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(n(this.to.x-this.from.x,2)+n(this.to.y-this.from.y,2))}getAngle(){let e=a.subtract(this.getRightVector(),this.getLeftVector());return e.angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),n=this.getRightVector(),r=i(e),a=o(e),s=a*(n.x-t.x)-r*(n.y-t.y)+t.x,g=r*(n.x-t.x)-a*(n.y-t.y)+t.y;return this.setRightVector(s,g),this}shortenFrom(e){let t=a.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=a.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=a.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}}t.exports=s},{"./Vector2":14}],9:[function(e,t){"use strict";var n=Math.round,r=Math.sin,o=Math.cos,a=Math.PI;class g{static round(e,t){return t=t?t:1,+(n(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,n=0;for(var a=0;a<e.length;a++)t+=r(e[a]),n+=o(e[a]);return Math.atan2(t/e.length,n/e.length)}static innerAngle(e){return g.toRad(180*(e-2)/e)}static polyCircumradius(e,t){return e/(2*r(a/t))}static apothem(e,t){return e*o(a/t)}static apothemFromSideLength(e,t){let n=g.polyCircumradius(e,t);return g.apothem(n,t)}static centralAngle(e){return g.toRad(360/e)}static toDeg(e){return e*g.degFactor}static toRad(e){return e*g.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),n=0,r=function(n,i=0){return 1===t[n]?i:(i++,t[n]=1,r(e[n],i))};for(var o=0;o<e.length;o++){if(1===t[o])continue;let e=r(o);n+=1-e%2}return n%2?-1:1}static get radFactor(){return a/180}static get degFactor(){return 180/a}static get twoPI(){return 2*a}}t.exports=g},{}],10:[function(e,t){"use strict";t.exports=function(){function e(t,n,i,r){this.message=t,this.expected=n,this.found=i,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}function t(t,n){function i(e,t){return{type:"literal",text:e,ignoreCase:t}}function r(e,t,n){return{type:"class",parts:e,inverted:t,ignoreCase:n}}function o(e){var n,i=Ve[e];if(i)return i;for(n=e-1;!Ve[n];)n--;for(i=Ve[n],i={line:i.line,column:i.column};n<e;)10===t.charCodeAt(n)?(i.line++,i.column=1):i.column++,n++;return Ve[e]=i,i}function a(e,t){var n=o(e),i=o(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:i.line,column:i.column}}}function s(e){De<ze||(De>ze&&(ze=De,We=[]),We.push(e))}function g(t,n){return new e(t,null,null,n)}function d(){var e,t,n,i,r,o,a,s,g,p;if(e=De,t=De,n=h(),n!==B){for(i=[],r=l();r!==B;)i.push(r),r=l();if(i!==B){for(r=[],o=De,a=c(),a===B&&(a=null),a===B?(De=o,o=B):(s=b(),s===B?(De=o,o=B):(a=[a,s],o=a));o!==B;)r.push(o),o=De,a=c(),a===B&&(a=null),a===B?(De=o,o=B):(s=b(),s===B?(De=o,o=B):(a=[a,s],o=a));if(r!==B){for(o=[],a=l();a!==B;)o.push(a),a=l();if(o===B)De=t,t=B;else if(a=c(),a===B&&(a=null),a===B)De=t,t=B;else if(s=d(),s===B&&(s=null),s!==B){for(g=[],p=l();p!==B;)g.push(p),p=l();g===B?(De=t,t=B):(n=[n,i,r,o,a,s,g],t=n)}else De=t,t=B}else De=t,t=B}else De=t,t=B}else De=t,t=B;return t!==B&&(Ne=e,t=L(t)),e=t,e}function l(){var e,n,i,r,o,a;return e=De,n=De,40===t.charCodeAt(De)?(i="(",De++):(i=B,s(E)),i===B?(De=n,n=B):(r=c(),r===B&&(r=null),r===B?(De=n,n=B):(o=d(),o===B?(De=n,n=B):(41===t.charCodeAt(De)?(a=")",De++):(a=B,s(O)),a===B?(De=n,n=B):(i=[i,r,o,a],n=i)))),n!==B&&(Ne=e,n=H(n)),e=n,e}function h(){var e,t;return e=De,t=u(),t===B&&(t=v(),t===B&&(t=p(),t===B&&(t=f()))),t!==B&&(Ne=e,t=D(t)),e=t,e}function c(){var e,n;if(e=De,N.test(t.charAt(De))){if(n=t.charAt(De),n===t.charAt(De+1))throw n=B,g("The parser encountered a bond repetition.",De+1);De++}else n=B,s(V);return n!==B&&(Ne=e,n=z(n)),e=n,e}function p(){var e,n,i,r,o,a,g,d,l,h;return e=De,n=De,91===t.charCodeAt(De)?(i="[",De++):(i=B,s(W)),i===B?(De=n,n=B):(r=j(),r===B&&(r=null),r===B?(De=n,n=B):("se"===t.substr(De,2)?(o="se",De+=2):(o=B,s(F)),o===B&&("as"===t.substr(De,2)?(o="as",De+=2):(o=B,s(M)),o===B&&(o=v(),o===B&&(o=m(),o===B&&(o=f())))),o===B?(De=n,n=B):(a=x(),a===B&&(a=null),a===B?(De=n,n=B):(g=R(),g===B&&(g=null),g===B?(De=n,n=B):(d=y(),d===B&&(d=null),d===B?(De=n,n=B):(l=A(),l===B&&(l=null),l===B?(De=n,n=B):(93===t.charCodeAt(De)?(h="]",De++):(h=B,s(q)),h===B?(De=n,n=B):(i=[i,r,o,a,g,d,l,h],n=i)))))))),n!==B&&(Ne=e,n=_(n)),e=n,e}function u(){var e,n,i,r;return e=De,n=De,66===t.charCodeAt(De)?(i="B",De++):(i=B,s(U)),i===B?(De=n,n=B):(114===t.charCodeAt(De)?(r="r",De++):(r=B,s(G)),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n===B&&(n=De,67===t.charCodeAt(De)?(i="C",De++):(i=B,s(X)),i===B?(De=n,n=B):(108===t.charCodeAt(De)?(r="l",De++):(r=B,s(Y)),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n===B&&(K.test(t.charAt(De))?(n=t.charAt(De),De++):(n=B,s(Z)))),n!==B&&(Ne=e,n=$(n)),e=n,e}function v(){var e,n;return e=De,J.test(t.charAt(De))?(n=t.charAt(De),De++):(n=B,s(Q)),n!==B&&(Ne=e,n=D(n)),e=n,e}function f(){var e,n;return e=De,42===t.charCodeAt(De)?(n="*",De++):(n=B,s(ee)),n!==B&&(Ne=e,n=te(n)),e=n,e}function m(){var e,n,i,r;return e=De,n=De,ne.test(t.charAt(De))?(i=t.charAt(De),De++):(i=B,s(ie)),i===B?(De=n,n=B):(re.test(t.charAt(De))?(r=t.charAt(De),De++):(r=B,s(oe)),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n!==B&&(Ne=e,n=ae(n)),e=n,e}function b(){var e,n,i,r,o;return e=De,n=De,37===t.charCodeAt(De)?(i="%",De++):(i=B,s(se)),i===B?(De=n,n=B):(ge.test(t.charAt(De))?(r=t.charAt(De),De++):(r=B,s(de)),r===B?(De=n,n=B):(le.test(t.charAt(De))?(o=t.charAt(De),De++):(o=B,s(he)),o===B?(De=n,n=B):(i=[i,r,o],n=i))),n===B&&(le.test(t.charAt(De))?(n=t.charAt(De),De++):(n=B,s(he))),n!==B&&(Ne=e,n=ce(n)),e=n,e}function x(){var e,n,i,r,o,a,g;return e=De,n=De,64===t.charCodeAt(De)?(i="@",De++):(i=B,s(pe)),i===B?(De=n,n=B):(64===t.charCodeAt(De)?(r="@",De++):(r=B,s(pe)),r===B&&(r=De,"TH"===t.substr(De,2)?(o="TH",De+=2):(o=B,s(ue)),o===B?(De=r,r=B):(ve.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(fe)),a===B?(De=r,r=B):(o=[o,a],r=o)),r===B&&(r=De,"AL"===t.substr(De,2)?(o="AL",De+=2):(o=B,s(me)),o===B?(De=r,r=B):(ve.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(fe)),a===B?(De=r,r=B):(o=[o,a],r=o)),r===B&&(r=De,"SP"===t.substr(De,2)?(o="SP",De+=2):(o=B,s(be)),o===B?(De=r,r=B):(xe.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(ye)),a===B?(De=r,r=B):(o=[o,a],r=o)),r===B&&(r=De,"TB"===t.substr(De,2)?(o="TB",De+=2):(o=B,s(Se)),o===B?(De=r,r=B):(ge.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(de)),a===B?(De=r,r=B):(le.test(t.charAt(De))?(g=t.charAt(De),De++):(g=B,s(he)),g===B&&(g=null),g===B?(De=r,r=B):(o=[o,a,g],r=o))),r===B&&(r=De,"OH"===t.substr(De,2)?(o="OH",De+=2):(o=B,s(Ce)),o===B?(De=r,r=B):(ge.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(de)),a===B?(De=r,r=B):(le.test(t.charAt(De))?(g=t.charAt(De),De++):(g=B,s(he)),g===B&&(g=null),g===B?(De=r,r=B):(o=[o,a,g],r=o)))))))),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n!==B&&(Ne=e,n=Re(n)),e=n,e}function y(){var e,t;return e=De,t=S(),t===B&&(t=C()),t!==B&&(Ne=e,t=Ae(t)),e=t,e}function S(){var e,n,i,r,o,a;return e=De,n=De,43===t.charCodeAt(De)?(i="+",De++):(i=B,s(je)),i===B?(De=n,n=B):(43===t.charCodeAt(De)?(r="+",De++):(r=B,s(je)),r===B&&(r=De,ge.test(t.charAt(De))?(o=t.charAt(De),De++):(o=B,s(de)),o===B?(De=r,r=B):(le.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(he)),a===B&&(a=null),a===B?(De=r,r=B):(o=[o,a],r=o))),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n!==B&&(Ne=e,n=Te(n)),e=n,e}function C(){var e,n,i,r,o,a;return e=De,n=De,45===t.charCodeAt(De)?(i="-",De++):(i=B,s(ke)),i===B?(De=n,n=B):(45===t.charCodeAt(De)?(r="-",De++):(r=B,s(ke)),r===B&&(r=De,ge.test(t.charAt(De))?(o=t.charAt(De),De++):(o=B,s(de)),o===B?(De=r,r=B):(le.test(t.charAt(De))?(a=t.charAt(De),De++):(a=B,s(he)),a===B&&(a=null),a===B?(De=r,r=B):(o=[o,a],r=o))),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n!==B&&(Ne=e,n=Ie(n)),e=n,e}function R(){var e,n,i,r;return e=De,n=De,72===t.charCodeAt(De)?(i="H",De++):(i=B,s(Be)),i===B?(De=n,n=B):(le.test(t.charAt(De))?(r=t.charAt(De),De++):(r=B,s(he)),r===B&&(r=null),r===B?(De=n,n=B):(i=[i,r],n=i)),n!==B&&(Ne=e,n=we(n)),e=n,e}function A(){var e,n,i,r,o,a,g;if(e=De,n=De,58===t.charCodeAt(De)?(i=":",De++):(i=B,s(Pe)),i!==B){if(r=De,ge.test(t.charAt(De))?(o=t.charAt(De),De++):(o=B,s(de)),o!==B){for(a=[],le.test(t.charAt(De))?(g=t.charAt(De),De++):(g=B,s(he));g!==B;)a.push(g),le.test(t.charAt(De))?(g=t.charAt(De),De++):(g=B,s(he));a===B?(De=r,r=B):(o=[o,a],r=o)}else De=r,r=B;r===B&&(Le.test(t.charAt(De))?(r=t.charAt(De),De++):(r=B,s(Ee))),r===B?(De=n,n=B):(i=[i,r],n=i)}else De=n,n=B;return n!==B&&(Ne=e,n=Oe(n)),e=n,e}function j(){var e,n,i,r,o;return e=De,n=De,ge.test(t.charAt(De))?(i=t.charAt(De),De++):(i=B,s(de)),i===B?(De=n,n=B):(le.test(t.charAt(De))?(r=t.charAt(De),De++):(r=B,s(he)),r===B&&(r=null),r===B?(De=n,n=B):(le.test(t.charAt(De))?(o=t.charAt(De),De++):(o=B,s(he)),o===B&&(o=null),o===B?(De=n,n=B):(i=[i,r,o],n=i))),n!==B&&(Ne=e,n=He(n)),e=n,e}n=void 0===n?{}:n;var T=t.split("(").length-1,k=t.split(")").length-1;if(T!==k)throw g("The number of opening parentheses does not match the number of closing parentheses.",0);var I,B={},w={chain:d},P=d,L=function(e){for(var t=[],n=[],r=0;r<e[1].length;r++)t.push(e[1][r]);for(var o,r=0;r<e[2].length;r++)o=e[2][r][0]?e[2][r][0]:"-",n.push({bond:o,id:e[2][r][1]});for(var r=0;r<e[3].length;r++)t.push(e[3][r]);for(var r=0;r<e[6].length;r++)t.push(e[6][r]);return{atom:e[0],isBracket:!!e[0].element,branches:t,branchCount:t.length,ringbonds:n,ringbondCount:n.length,bond:e[4]?e[4]:"-",next:e[5],hasNext:!!e[5]}},E=i("(",!1),O=i(")",!1),H=function(e){var t=e[1]?e[1]:"-";return e[2].branchBond=t,e[2]},D=function(e){return e},N=/^[\-=#$:\/\\.]/,V=r(["-","=","#","$",":","/","\\","."],!1,!1),z=function(e){return e},W=i("[",!1),F=i("se",!1),M=i("as",!1),q=i("]",!1),_=function(e){return{isotope:e[1],element:e[2],chirality:e[3],hcount:e[4],charge:e[5],class:e[6]}},U=i("B",!1),G=i("r",!1),X=i("C",!1),Y=i("l",!1),K=/^[NOPSFI]/,Z=r(["N","O","P","S","F","I"],!1,!1),$=function(e){return 1<e.length?e.join(""):e},J=/^[bcnops]/,Q=r(["b","c","n","o","p","s"],!1,!1),ee=i("*",!1),te=function(e){return e},ne=/^[A-Z]/,ie=r([["A","Z"]],!1,!1),re=/^[a-z]/,oe=r([["a","z"]],!1,!1),ae=function(t){return t.join("")},se=i("%",!1),ge=/^[1-9]/,de=r([["1","9"]],!1,!1),le=/^[0-9]/,he=r([["0","9"]],!1,!1),ce=function(e){return 1==e.length?+e:+e.join("").replace("%","")},pe=i("@",!1),ue=i("TH",!1),ve=/^[12]/,fe=r(["1","2"],!1,!1),me=i("AL",!1),be=i("SP",!1),xe=/^[1-3]/,ye=r([["1","3"]],!1,!1),Se=i("TB",!1),Ce=i("OH",!1),Re=function(e){return e[1]?"@"==e[1]?"@@":e[1].join("").replace(",",""):"@"},Ae=function(e){return e},je=i("+",!1),Te=function(e){return e[1]?"+"==e[1]?2:+e[1].join(""):1},ke=i("-",!1),Ie=function(e){return e[1]?"-"==e[1]?-2:-+e[1].join(""):-1},Be=i("H",!1),we=function(e){return e[1]?+e[1]:1},Pe=i(":",!1),Le=/^[0]/,Ee=r(["0"],!1,!1),Oe=function(e){return+(e[1][0]+e[1][1].join(""))},He=function(e){return+e.join("")},De=0,Ne=0,Ve=[{line:1,column:1}],ze=0,We=[];if("startRule"in n){if(!(n.startRule in w))throw new Error("Can't start parsing from rule \""+n.startRule+"\".");P=w[n.startRule]}if(I=P(),I!==B&&De===t.length)return I;throw I!==B&&De<t.length&&s(function(){return{type:"end"}}()),function(t,n,i){return new e(e.buildMessage(t,n),t,n,i)}(We,ze<t.length?t.charAt(ze):null,ze<t.length?a(ze,ze+1):a(ze,ze))}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),e.buildMessage=function(e,t){function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,"\\\"").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function o(e){return a[e.type](e)}var a={literal:function(e){return"\""+i(e.text)+"\""},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?r(e.parts[t][0])+"-"+r(e.parts[t][1]):r(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};return"Expected "+function(e){var t,n,r=Array(e.length);for(t=0;t<e.length;t++)r[t]=o(e[t]);if(r.sort(),0<r.length){for(t=1,n=1;t<r.length;t++)r[t-1]!==r[t]&&(r[n]=r[t],n++);r.length=n}switch(r.length){case 1:return r[0];case 2:return r[0]+" or "+r[1];default:return r.slice(0,-1).join(", ")+", or "+r[r.length-1];}}(e)+" but "+function(e){return e?"\""+i(e)+"\"":"end of input"}(t)+" found."},{SyntaxError:e,parse:t}}()},{}],11:[function(e,t){"use strict";const n=e("./ArrayHelper"),i=e("./Vector2"),r=e("./Vertex"),o=e("./RingConnection");class a{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new i(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new a(this.members);return e.id=this.id,e.insiders=n.clone(this.insiders),e.neighbours=n.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=n.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let n=0;n<this.members.length;n++)t.push(e[this.members[n]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,n,i){n=n||0===n?n:this.members[0];let r=n,o=0;for(;null!=r&&100>o;){let a=r;t(a),r=e[r].getNextInRing(e,this.id,i),i=a,r==n&&(r=null),o++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let n,r=0;r<this.neighbours.length;r++)n=o.getVertices(e,this.id,this.neighbours[r]),t[r]={n:n.length,neighbour:this.neighbours[r]};return t.sort(function(e,t){return t.n-e.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),n=this.members.length;return 3===t&&6===n||2===t&&5===n}getDoubleBondCount(e){let t=0;for(let n,r=0;r<this.members.length;r++)n=e[this.members[r]].value,("="===n.bondType||"="===n.branchBond)&&t++;return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}}t.exports=a},{"./ArrayHelper":2,"./RingConnection":12,"./Vector2":14,"./Vertex":15}],12:[function(e,t){"use strict";const n=e("./Vertex"),i=e("./Ring");t.exports=class{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var n=0;n<e.members.length;n++){let i=e.members[n];for(let e,r=0;r<t.members.length;r++)e=t.members[r],i===e&&this.addVertex(i)}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(2<this.vertices.size)return!0;for(let t of this.vertices)if(2<e[t].value.rings.length)return!0;return!1}static isBridge(e,t,n,r){let o=null;for(let a=0;a<e.length;a++)if(o=e[a],o.firstRingId===n&&o.secondRingId===r||o.firstRingId===r&&o.secondRingId===n)return o.isBridge(t);return!1}static getNeighbours(e,t){let n=[];for(let r,o=0;o<e.length;o++)r=e[o],r.firstRingId===t?n.push(r.secondRingId):r.secondRingId===t&&n.push(r.firstRingId);return n}static getVertices(e,t,n){for(let r,o=0;o<e.length;o++)if(r=e[o],r.firstRingId===t&&r.secondRingId===n||r.firstRingId===n&&r.secondRingId===t)return[...r.vertices]}}},{"./Ring":11,"./Vertex":15}],13:[function(e,t){"use strict";const n=e("./Graph");class r{static getRings(e,t=!1){let o=e.getComponentsAdjacencyMatrix();if(0===o.length)return null;let a=n.getConnectedComponents(o),s=[];for(var g=0;g<a.length;g++){let n=a[g],i=e.getSubgraphAdjacencyMatrix([...n]),o=new Uint16Array(i.length),h=new Uint16Array(i.length);for(var d=0;d<i.length;d++){h[d]=0,o[d]=0;for(var l=0;l<i[d].length;l++)o[d]+=i[d][l]}let p=0;for(var d=0;d<i.length;d++)for(var l=d+1;l<i.length;l++)p+=i[d][l];let u=p-i.length+1,v=!0;for(var d=0;d<o.length;d++)3!==o[d]&&(v=!1);if(v&&(u=2+p-i.length),1==u){s.push([...n]);continue}t&&(u=999);let{d:f,pe:m,pe_prime:b}=r.getPathIncludedDistanceMatrices(i),x=r.getRingCandidates(f,m,b),c=r.getSSSR(x,f,i,m,b,o,h,u);for(var d=0;d<c.length;d++){let e=Array(c[d].size),t=0;for(let i of c[d])e[t++]=n[i];s.push(e)}}return s}static matrixToString(e){let t="";for(var n=0;n<e.length;n++){for(var r=0;r<e[n].length;r++)t+=e[n][r]+" ";t+="\n"}return t}static getPathIncludedDistanceMatrices(e){var t=Number.POSITIVE_INFINITY;let r=e.length,o=Array(r),a=Array(r),s=Array(r);for(var g=0,d=0,h=0,c=r;c--;){o[c]=Array(r),a[c]=Array(r),s[c]=Array(r);for(var p=r;p--;)o[c][p]=c===p||1===e[c][p]?e[c][p]:t,a[c][p]=1===o[c][p]?[[[c,p]]]:[],s[c][p]=[]}for(var p,u=r;u--;)for(c=r;c--;)for(p=r;p--;){const e=o[c][p],t=o[c][u]+o[u][p];if(e>t){var g,d,h;if(e===t+1)for(s[c][p]=[a[c][p].length],g=a[c][p].length;g--;)for(s[c][p][g]=[a[c][p][g].length],d=a[c][p][g].length;d--;)for(s[c][p][g][d]=[a[c][p][g][d].length],h=a[c][p][g][d].length;h--;)s[c][p][g][d][h]=[a[c][p][g][d][0],a[c][p][g][d][1]];else s[c][p]=[];for(o[c][p]=t,a[c][p]=[[]],g=a[c][u][0].length;g--;)a[c][p][0].push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)a[c][p][0].push(a[u][p][0][g])}else if(e===t){if(a[c][u].length&&a[u][p].length){var g;if(a[c][p].length){let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);a[c][p].push(e)}else{let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);a[c][p][0]=e}}}else if(e===t-1){var g;if(s[c][p].length){let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);s[c][p].push(e)}else{let e=[];for(g=a[c][u][0].length;g--;)e.push(a[c][u][0][g]);for(g=a[u][p][0].length;g--;)e.push(a[u][p][0][g]);s[c][p][0]=e}}}return{d:o,pe:a,pe_prime:s}}static getRingCandidates(e,t,n){let r=e.length,o=[],a=0;for(let s=0;s<r;s++)for(let i=0;i<r;i++)if(0===e[s][i]||1===t[s][i].length&&0===n[s][i])continue;else a=0===n[s][i].length?2*e[s][i]:2*(e[s][i]+.5),a!==1/0&&o.push([a,t[s][i],n[s][i]]);return o.sort(function(e,t){return e[0]-t[0]}),o}static getSSSR(e,t,n,i,o,a,s,g){let d=[],l=[];for(let c=0;c<e.length;c++)if(0!=e[c][0]%2)for(let t,i=0;i<e[c][2].length;i++){t=e[c][1][0].concat(e[c][2][i]);for(var h=0;h<t.length;h++)t[h][0].constructor===Array&&(t[h]=t[h][0]);let o=r.bondsToAtoms(t);if(r.getBondCount(o,n)!==o.size||r.pathSetsContain(d,o,t,l,a,s)||(d.push(o),l=l.concat(t)),d.length>g)return d}else for(let t,i=0;i<e[c][1].length-1;i++){t=e[c][1][i].concat(e[c][1][i+1]);for(var h=0;h<t.length;h++)t[h][0].constructor===Array&&(t[h]=t[h][0]);let o=r.bondsToAtoms(t);if(r.getBondCount(o,n)!==o.size||r.pathSetsContain(d,o,t,l,a,s)||(d.push(o),l=l.concat(t)),d.length>g)return d}return d}static getEdgeCount(e){let t=0,n=e.length;for(var r=n-1;r--;)for(var o=n;o--;)1===e[r][o]&&t++;return t}static getEdgeList(e){let t=e.length,n=[];for(var r=t-1;r--;)for(var o=t;o--;)1===e[r][o]&&n.push([r,o]);return n}static bondsToAtoms(e){let t=new Set;for(var n=e.length;n--;)t.add(e[n][0]),t.add(e[n][1]);return t}static getBondCount(e,t){let n=0;for(let i of e)for(let r of e)i!==r&&(n+=t[i][r]);return n/2}static pathSetsContain(e,t,n,o,a,s){for(var g=e.length;g--;){if(r.isSupersetOf(t,e[g]))return!0;if(e[g].size===t.size&&r.areSetsEqual(e[g],t))return!0}let d=0,l=!1;for(g=n.length;g--;)for(var h=o.length;h--;)(n[g][0]===o[h][0]&&n[g][1]===o[h][1]||n[g][1]===o[h][0]&&n[g][0]===o[h][1])&&d++,d===n.length&&(l=!0);let c=!1;if(l)for(let e of t)if(s[e]<a[e]){c=!0;break}if(l&&!c)return!0;for(let i of t)s[i]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}static isSupersetOf(e,t){for(var n of t)if(!e.has(n))return!1;return!0}}t.exports=r},{"./Graph":7}],14:[function(e,t){"use strict";var n=Math.acos,i=Math.sin,r=Math.cos,o=Math.sqrt;class g{constructor(e,t){0==arguments.length?(this.x=0,this.y=0):1==arguments.length?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new g(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return o((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,n=this.x*e.y;if(t>n)return-1;return t===n?0:1}relativeClockwise(e,t){let n=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);if(n>i)return-1;return n===i?0:1}rotate(e){let t=new g(0,0),n=r(e),o=i(e);return t.x=this.x*n-this.y*o,t.y=this.x*o+this.y*n,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let n=i(e),o=r(e);this.x-=t.x,this.y-=t.y;let a=this.x*o-this.y*n,s=this.x*n+this.y*o;return this.x=a+t.x,this.y=s+t.y,this}rotateTo(e,t,n=0){this.x+=.001,this.y-=.001;let i=g.subtract(this,t),r=g.subtract(e,t),o=g.angle(r,i);return this.rotateAround(o+n,t),this}rotateAwayFrom(e,t,n){this.rotateAround(n,t);let i=this.distanceSq(e);this.rotateAround(-2*n,t);let r=this.distanceSq(e);r<i&&this.rotateAround(2*n,t)}getRotateAwayFromAngle(e,t,n){let i=this.clone();i.rotateAround(n,t);let r=i.distanceSq(e);i.rotateAround(-2*n,t);let o=i.distanceSq(e);return o<r?n:-n}getRotateTowardsAngle(e,t,n){let i=this.clone();i.rotateAround(n,t);let r=i.distanceSq(e);i.rotateAround(-2*n,t);let o=i.distanceSq(e);return o>r?n:-n}getRotateToAngle(e,t){let n=g.subtract(this,t),i=g.subtract(e,t),r=g.angle(i,n);return Number.isNaN(r)?0:r}isInPolygon(e){let t=!1;for(let n=0,i=e.length-1;n<e.length;i=n++)e[n].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[n].x)*(this.y-e[n].y)/(e[i].y-e[n].y)+e[n].x&&(t=!t);return t}length(){return o(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return g.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,n){let i=this.whichSide(e,t),r=n.whichSide(e,t);return 0>i&&0>r||0==i&&0==r||0<i&&0<r}static add(e,t){return new g(e.x+t.x,e.y+t.y)}static subtract(e,t){return new g(e.x-t.x,e.y-t.y)}static multiply(e,t){return new g(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new g(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new g((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let n=g.subtract(t,e);return[new g(-n.y,n.x),new g(n.y,-n.x)]}static units(e,t){let n=g.subtract(t,e);return[new g(-n.y,n.x).normalize(),new g(n.y,-n.x).normalize()]}static divide(e,t){return new g(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new g(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let i=g.dot(e,t);return n(i/(e.length()*t.length()))}static threePointangle(e,t,i){let r=g.subtract(t,e),o=g.subtract(i,t),a=e.distance(t),s=t.distance(i);return n(g.dot(r,o)/(a*s))}static scalarProjection(e,t){let n=t.normalized();return g.dot(e,n)}static averageDirection(e){let t=new g(0,0);for(var n=0;n<e.length;n++){let i=e[n];t.add(i)}return t.normalize()}}t.exports=g},{}],15:[function(e,t){"use strict";var n=Math.round,i=Math.PI;const r=e("./MathHelper"),o=e("./ArrayHelper"),a=e("./Vector2"),s=e("./Atom");class g{constructor(e,t=0,n=0){this.id=null,this.value=e,this.position=new a(t?t:0,n?n:0),this.previousPosition=new a(0,0),this.parentVertexId=null,this.children=[],this.spanningTreeChildren=[],this.edges=[],this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=[],this.neighbouringElements=[],this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let n=1;0===this.id&&0===this.value.bracket.hcount&&(n=0),1===this.value.bracket.hcount&&0===t&&(n=2),1===this.value.bracket.hcount&&1===t&&(3>this.neighbours.length?n=2:n=3),null===this.value.bracket.hcount&&0===t&&(n=1),null===this.value.bracket.hcount&&1===t&&(3>this.neighbours.length?n=1:n=2),this.neighbours.splice(n,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return!!this.value.hasAttachedPseudoElements||null===this.parentVertexId&&2>this.children.length||0===this.children.length}clone(){let e=new g(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new a(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=o.clone(this.children),e.spanningTreeChildren=o.clone(this.spanningTreeChildren),e.edges=o.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let n=null;return n=e?a.subtract(this.position,e):a.subtract(this.position,this.previousPosition),t?r.toDeg(n.angle()):n.angle()}getTextDirection(e){let t=this.getDrawnNeighbours(e),o=[];for(let n=0;n<t.length;n++)o.push(this.getAngle(e[t[n]].position));let a=r.meanAngle(o),s=i/2;return a=n(n(a/s)*s),2===a?"down":-2===a?"up":0===a||-0===a?"right":3===a||-3===a?"left":"down"}getNeighbours(e=null){if(null===e)return this.neighbours.slice();let t=[];for(let n=0;n<this.neighbours.length;n++)this.neighbours[n]!==e&&t.push(this.neighbours[n]);return t}getDrawnNeighbours(e){let t=[];for(let n=0;n<this.neighbours.length;n++)e[this.neighbours[n]].value.isDrawn&&t.push(this.neighbours[n]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=[];for(let n=0;n<this.spanningTreeChildren.length;n++)(void 0===e||e!=this.spanningTreeChildren[n])&&t.push(this.spanningTreeChildren[n]);return null!=this.parentVertexId&&(void 0===e||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,n){let r=this.getNeighbours();for(let a=0;a<r.length;a++)if(o.contains(e[r[a]].value.rings,{value:t})&&r[a]!=n)return r[a];return null}}t.exports=g},{"./ArrayHelper":2,"./Atom":3,"./MathHelper":9,"./Vector2":14}]},{},[1]);
//# sourceMappingURL=smiles-drawer.min.js.map
